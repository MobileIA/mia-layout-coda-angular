<div *ngIf="tableConfig" class="coda-table">

    <div class="scroll-x">
        <table mat-table [dataSource]="dataItems.data">

            <ng-container *ngFor="let column of tableConfig.columns" [matColumnDef]="column.key">
                <!-- TH -->
                <mat-header-cell *matHeaderCellDef>

                    <ng-container *ngIf="column.type == 'checkbox'; else defaultTh">
                        <mat-checkbox></mat-checkbox>
                    </ng-container>
                    <ng-template #defaultTh>
                        <button (click)="onClickOrder(column)">
                            {{ column.title }}
                            <div class="sort-icon">
                                <mat-icon [ngClass]="{'active': column.is_order && column.order_type == 1}">arrow_drop_up</mat-icon>
                                <mat-icon [ngClass]="{'active': column.is_order && column.order_type == 2}">arrow_drop_down</mat-icon>
                            </div>
                            <!-- <mat-icon *ngIf="column.is_order && column.order_type == 1">arrow_drop_up</mat-icon>
                            <mat-icon *ngIf="column.is_order && column.order_type == 2">arrow_drop_down</mat-icon> -->
                        </button>
                    </ng-template>
                    
                </mat-header-cell>

                
                <!-- TD -->
                <mat-cell *matCellDef="let item">

                    <ng-container *ngIf="column.type == 'checkbox'" sticky>
                        <mat-checkbox></mat-checkbox>
                    </ng-container>

                    <ng-container *ngIf="column.type == 'integer' || column.type == 'string'">
                        <p class="{{ column.classes }}">{{ item[column.field_key] }}</p>
                    </ng-container>

                    <ng-container *ngIf="column.type == 'photo'">
                        <!-- <img *ngIf="item[column.field_key_photo] == '' || item[column.field_key_photo] == undefined" [src]="'https://i0.wp.com/avatar-management--avatars.us-west-2.prod.public.atl-paas.net/initials/MC-2.png?ssl=1'" /> -->
                        <img [src]="item[column.field_key_photo]" onerror="this.src='/assets/img/image-user-profile-not-found.png';" />
                        <a *ngIf="column.url == undefined && column.field_key" class="{{ column.classes }}"><p>{{ item[column.field_key] }}</p></a>
                        <a *ngIf="column.url != undefined && column.field_key" [routerLink]="getLinkUrl(column, item)" class="{{ column.classes }}"><p>{{ item[column.field_key] }}</p></a>
                    </ng-container>

                    <ng-container *ngIf="column.type == 'money'">
                        <p class="{{ column.classes }}">{{ item[column.field_key] | currency }}</p>
                    </ng-container>

                    <ng-container *ngIf="column.type == 'link'">
                        <a [routerLink]="getLinkUrl(column, item)" class="{{ column.classes }}">{{ item[column.field_key] }}</a>
                    </ng-container>

                    <ng-container *ngIf="column.type == 'option'">
                        <p class="{{ column.classes }}">{{ column.options[item[column.field_key]].title }}</p>
                    </ng-container>

                    <ng-container *ngIf="column.type == 'select'">
                        <mat-form-field appearance="outline">
                            <mat-label>{{ column.title }}</mat-label>
                            <mat-select [(ngModel)]="item[column.field_key]" (selectionChange)="onChangeSelectValue(column, item)">
                                <mat-option *ngFor="let opt of column.options" [value]="opt.value">
                                    {{ opt.title }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </ng-container>

                    <ng-container *ngIf="column.type == 'actions'" class="actions">
                        <ng-container *ngFor="let act of column.options">

                            <a *ngIf="act.type != 'delete'" [routerLink]="getLinkAction(column, act, item)" class="{{ column.classes }}">
                                <mat-icon *ngIf="act.icon">{{act.icon}}</mat-icon>
                                {{ act.title }}
                            </a>

                            <a *ngIf="act.type == 'delete'" class="{{ column.classes }}" [swal]="{ title: 'Eliminar ', text: '¿Se encuentra seguro de eliminar?', type: 'warning', focusCancel: true, showCancelButton: true, confirmButtonText: 'Eliminar', cancelButtonText: 'Cancelar' }" icon="question"
                            (confirm)="onRemoveItem(item)">
                                <mat-icon *ngIf="act.icon">{{act.icon}}</mat-icon>
                                {{ act.title }}
                            </a>

                        </ng-container>
                        
                    </ng-container>

                    <ng-container *ngIf="column.type == 'actions-list'">
                        <button mat-icon-button [matMenuTriggerFor]="moreMenu" aria-label="Actions" (click)="$event.stopPropagation();">
                            <mat-icon class="secondary-text">more_vert</mat-icon>
                        </button>

                        <mat-menu #moreMenu="matMenu">

                            <ng-container *ngFor="let act of column.options">

                                <button *ngIf="act.type != 'delete'" [routerLink]="getLinkAction(column, act, item)" class="{{ column.classes }}" mat-menu-item>
                                    <mat-icon *ngIf="act.icon">{{act.icon}}</mat-icon>
                                    {{ act.title }}
                                </button>
    
                                <button *ngIf="act.type == 'delete'" class="{{ column.classes }}" mat-menu-item [swal]="{ title: 'Eliminar ', text: '¿Se encuentra seguro de eliminar?', type: 'warning', focusCancel: true, showCancelButton: true, confirmButtonText: 'Eliminar', cancelButtonText: 'Cancelar' }" icon="question"
                                (confirm)="onRemoveItem(item)">
                                    <mat-icon *ngIf="act.icon">{{act.icon}}</mat-icon>
                                    {{ act.title }}
                                </button>
    
                            </ng-container>

                        </mat-menu>
                      
                    </ng-container>

                </mat-cell>

            </ng-container>

            <mat-header-row *matHeaderRowDef="getDisplayColumns(); sticky: true"></mat-header-row>
            <mat-row *matRowDef="let row; columns: getDisplayColumns();"></mat-row>
        </table>
    </div>

    <div class="">

        <a *ngFor="let action of tableConfig.extrasActions" [routerLink]="action.url">{{ action.title }}</a>

        <mat-paginator *ngIf="tableConfig.isShowPaginator" [length]="dataItems.total" [pageSize]="tableConfig.params.itemPerPage" [pageSizeOptions]="[5, 10, 25, 100]" (page)="onPageChange($event)"></mat-paginator>
    </div>

    
</div>